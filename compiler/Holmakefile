INCLUDES = ../semantics ../bytecode ../../lem/hol-lib

OPTIONS = QUIT_ON_FAILURE

SEMANTICSI = lib ast semanticPrimitives
BYTECODEI = compilerLib printer bytecode
COMPILER = intLang toIntLang toBytecode compiler
GEN_SCRIPTS =  $(patsubst %,%Script.sml,$(COMPILER))

LEMI = $(patsubst %,../semantics/%.lem,$(SEMANTICSI)) $(patsubst %,../bytecode/%.lem,$(BYTECODEI))
LEMH = $(patsubst %,%.lem,$(COMPILER))

$(GEN_SCRIPTS): $(LEMI) $(LEMH)
	lem -auxiliary_level auto $(patsubst %,-i %,$(LEMI)) $(patsubst %,-hol %,$(LEMH))

ifdef POLY
#HOLHEAP = heap
PARENT_HOLHEAP = ../semantics/sem_heap
EXTRA_CLEANS = $(HOLHEAP) $(HOLHEAP).o

BARE_THYS = ../semantics/terminationTheory ../bytecode/bytecodeExtraTheory
DEPS = $(patsubst %,%.uo,$(BARE_THYS))

$(HOLHEAP): $(DEPS)
	$(protect $(HOLDIR)/bin/buildheap) -b $(PARENT_HOLHEAP) -o $(HOLHEAP) $(BARE_THYS)
endif
